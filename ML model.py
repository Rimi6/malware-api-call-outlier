import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.cluster import DBSCAN

# Read sample_analysis_data.csv
csv_path = 'malware_api_class/sample_analysis_data.csv'
df = pd.read_csv(csv_path, names=['API Calls'])

# Drop rows with empty API calls (if any)
df.dropna(subset=['API Calls'], inplace=True)

# Create a TF-IDF vectorizer
vectorizer = TfidfVectorizer()
X = vectorizer.fit_transform(df['API Calls'])

# Apply DBSCAN for anomaly detection
eps = 0.5
min_samples = 5
dbscan = DBSCAN(eps=eps, min_samples=min_samples)
df['Outlier'] = dbscan.fit_predict(X.toarray())

# Count outliers
outliers_count = len(df[df['Outlier'] == -1])

# Print samples with -1 label as outliers
outliers = df[df['Outlier'] == -1]
common = df[df['Outlier'] != -1]

print("Outliers Count:", outliers_count)
print("\nOutliers:")
print(outliers)

print("\nCommon (Non-Outliers):")
print(common)
